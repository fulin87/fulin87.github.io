<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script>if (/*@cc_on!@*/false || (!!window.MSInputMethodContext && !!document.documentMode)) window.location.href="https://support.dmeng.net/upgrade-your-browser.html?referrer="+encodeURIComponent(window.location.href); </script>
    
    
        <link rel="shortcut icon" href="/images/favicon.ico">
    
     
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.13.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.2.30/dist/vuetify.min.css" rel="stylesheet">
    
<link rel="stylesheet" href="/content/css/main.css">

    
    







    
    
          

    
    
    
    
    <title>
        
            mysql中sql优化的思路和原则 | 水货程序员的笔记
        
    </title>
    
    
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div id="app">
        <v-app>
            <v-content id="page">
                <v-container fluid>
                    <v-row>
                        <v-col cols="2" class="d-none d-md-block">
                            <div id="sidebar" class="float-right">
    <a href="/content/" rel="home">
        <v-avatar size=96>
            <img id="logo" src="/images/avatar.webp">     
        </v-avatar> 
    </a>
    <v-divider></v-divider>
    <div class="mini-menu">
        <v-btn icon href="/content/">
            <v-icon>home</v-icon>
        </v-btn>
        <v-btn icon href="/content/categories/">
            <v-icon>folder</v-icon>
        </v-btn>
        <v-btn icon href="/content/tags/">
            <v-icon>bookmark</v-icon>
        </v-btn>
        <v-btn icon @click="SetNightMode">
            <v-icon>{{ nightMode }}</v-icon>
        </v-btn>
    </div>
    <v-list id="main-menu" class="font-weight-bold" flat>
        
            
            <v-list-item href="/content/archives/" link>
            <v-list-item-icon><v-icon>archive</v-icon></v-list-item-icon>
            <v-list-item-content>
                归档
            </v-list-item-content>
            </v-list-item>
        
            
            <v-list-item href="/content/about/" link>
            <v-list-item-icon><v-icon>account_circle</v-icon></v-list-item-icon>
            <v-list-item-content>
                关于
            </v-list-item-content>
            </v-list-item>
        
    </v-list>
    <v-divider></v-divider>
    
        <div class="post-toc">
            <a href="/content/2016/09/22/2016-09-22-mysql-update/" class="toc-header">文章目录</a>
            <div class="toc-content">
                <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E4%B9%8E%E5%85%B6%E5%86%85%EF%BC%9B%E5%87%BA%E4%B9%8E%E5%85%B6%E5%A4%96"><span class="toc-number">1.</span> <span class="toc-text">入乎其内；出乎其外</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="toc-number">2.</span> <span class="toc-text">SQL优化的思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%88%99"><span class="toc-number">3.</span> <span class="toc-text">SQL优化的基本原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">索引相关的总结</span></a></li></ol>
            </div>
        </div>
    

    <div id="footer">
        <div class="footer-social">
            
                
                <v-btn icon href="/content/fulin87@sina.com" target="_blank">
                    <v-icon>fas fa-envelope</v-icon>
                </v-btn>
            
                
                <v-btn icon href="https://github.com/fulin87" target="_blank">
                    <v-icon>fab fa-github</v-icon>
                </v-btn>
            
        </div>
        <v-divider></v-divider>
        <div class="footer-content">
            
                <span id="busuanzi_container_site_uv" style="display: none;"> 
                    总访客量 <span id="busuanzi_value_site_uv"></span>
                </span>
                <br>
            
            <span>Theme: <a target="_blank" rel="noopener" href="https://github.com/kb1000fx/hexo-theme-insulin">Insulin</a></span><br>
            <span>Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span><br>
            <span>
                &copy; 2015 - 2021 
                fuliln
            </span>
        </div>
    </div>
</div>

                        </v-col>
                        <v-col cols="12" md="10">
                            <v-row>
  <v-col cols="12" md="8" align-self="end">
    <div id="site-header">
      <div id="site-title">
        <a href="/content/" rel="home">水货程序员的笔记</a>
      </div>
      <div id="site-description"></div>
      <div id="mobile-menu" class="d-block d-md-none">
        <v-text-field label="请输入关键字" data-src="search.xml" v-model="searchHeaderValue" prepend-inner-icon="search" clearable clear-icon="clear" @keydown.enter="EnterSearch(searchHeaderValue,false)"></v-text-field>
        <div class="mobile-mini-menu">
          <v-btn icon href="/">
              <v-icon>home</v-icon>
          </v-btn>
          <v-btn icon href="/categories/">
              <v-icon>folder</v-icon>
          </v-btn>
          <v-btn icon href="/tags/">
              <v-icon>bookmark</v-icon>
          </v-btn>
          <v-btn icon @click="SetNightMode">
              <v-icon>{{ nightMode }}</v-icon>
          </v-btn>
          
            
            <v-btn icon href="/content/archives/">
              <v-icon>archive</v-icon>
            </v-btn>
          
            
            <v-btn icon href="/content/about/">
              <v-icon>account_circle</v-icon>
            </v-btn>
          
        </div>
      </div>    
    </div>
  </v-col>  
  <v-col cols="4" align-self="end" class="d-none d-md-block">
    <v-col align-self="end">
      <v-text-field label="请输入关键字" data-src="search.xml" v-model="searchHeaderValue" prepend-icon="search" clearable clear-icon="clear" @keydown.enter="EnterSearch(searchHeaderValue,false)"></v-text-field>
    </v-col> 
  </v-col>
</v-row>

                            <v-card class="elevation-2 post-card">
    
    
        <div class="post-header">
  <a class="post-header-title font-weight-medium" href="/content/2016/09/22/2016-09-22-mysql-update/">mysql中sql优化的思路和原则</a>
  <div class="post-header-meta">   
    <span>
      <v-icon color="">event</v-icon>
      发布于:&nbsp;2016-09-22
    </span>
    <span>
      <v-icon color="">event_available</v-icon>
      更新于:&nbsp;2020-12-15
    </span>
    <span>
      <v-icon color="">folder</v-icon>
      分类于:&nbsp;<a class="category-link" href="/content/categories/%E5%AD%98%E5%82%A8/">存储</a>
    </span>
    
    <span>
      <v-icon color="">visibility</v-icon>
      阅读次数:&nbsp;<span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
    </span>
    
  </div>
</div>

    
    
    
    
    <div class="post-content typo">
        <blockquote>
<p>大部分系统的性能瓶颈都是IO操作，数据库的IO消耗是其中的重要组成部分，SQL语句性能的优化是很有必要的，如果一开始不注意，后期的改动成本是比较大的,下面是根据我自己的经验总结的一套sql优化的思路和方法，不一定是最好的，但是却真实的产生过效果。</p>
</blockquote>
<h3 id="入乎其内；出乎其外"><a href="#入乎其内；出乎其外" class="headerlink" title="入乎其内；出乎其外"></a>入乎其内；出乎其外</h3><p> <em>为什么人类到今天为止对宇宙的认识都很有限？因为我们自己就在宇宙之中；为什么人类到今天为止对海洋的认识都很少？因为人类从来没有正真的进入过海洋！</em></p>
<p> 一样的道理，认识一个事物，最有效的方式就是：先站在事物的外面观察观察它，然后进入事物的内部再研究它，这样才是最全面的。</p>
<p> 对于SQL来说，平时使用sql，编写sql语句就相当于站在sql的外面观察它，但是sql的内部机制和执行过程是怎样的呢？一个sql语句的执行过程，大致是这样的：</p>
<pre><code>8    SELECT  DISTINCT &lt;select_list&gt;
1    FROM &lt;left_table&gt;
3    &lt;join_type&gt;JOIN&lt;right_table&gt;
2        ON&lt;join_condition&gt;
4    WHERE &lt;where_condition&gt;
5    GROUP BY&lt;group_by_list&gt;
6    WITH&#123;CUBE|ROLLUP&#125;
7    HAVING&lt;having_condition&gt;
10    ORDER BY&lt;order_by_list&gt;
11    LIMIT&lt;limit_number&gt;
</code></pre>
<p>下面是详细的执行过程</p>
<pre><code>1,FROM :     对FROM的左边表和右边的表计算笛卡尔积，产生虚拟表VT1。
2,ON :         对虚拟表VT1进行ON筛选，只有那些符合&lt;join_condition&gt;的行才会被记录在虚拟表VT2中。
3,JOIN :     如果指定了OUTER JOIN (比如left join,right join),那么保留表中未匹配的行就会作为外部行添加到虚拟表VT2中，产生虚拟表VT3,from 字句中包含两个以上的表的话，就会对上一个join连接产生的结果VT3和下一个表重复执行步骤1-3这三个步骤，一直到处理完所有的表为止。
4,WHERE :     对虚拟表VT3进行WHERE条件过滤。只要符合&lt;where-condition&gt;的记录才会被插入到虚拟表VT4中。
5,GROUP BY :     根据group by字句中的列，对VT4中的记录进行分组操作，产生VT5。
6,CUBE | ROLLUP: 对表VT5进行cube或者rollup操作，产生表VT6。
7,HAVING：    对虚拟表VT6应用having过滤，只有符合&lt;having-condition&gt;的记录才会被 插入到虚拟表VT7中。
8,SELECT：     执行select操作，选择指定的列，插入到虚拟表VT8中。
9,DISTINCT：     对VT8中的记录进行去重。产生虚拟表VT9。
10,ORDER BY:     将虚拟表VT9中的记录按照&lt;order_by_list&gt;进行排序操作，产生虚拟表VT10。
11,LIMIT：    取出指定行的记录，产生虚拟表VT11, 并将结果返回。
</code></pre>
<h3 id="SQL优化的思路"><a href="#SQL优化的思路" class="headerlink" title="SQL优化的思路"></a>SQL优化的思路</h3><ul>
<li>1.优化更需要优化的sql；</li>
<li>2.定位优化对象的性能瓶颈：优化前需了解查询的瓶颈是IO还是CPU可通过PROFILING很容易定位查询的瓶颈。</li>
<li>3.明确优化目标；</li>
<li>4.从Explain入手；</li>
<li>5.多使用profile；</li>
</ul>
<h3 id="SQL优化的基本原则"><a href="#SQL优化的基本原则" class="headerlink" title="SQL优化的基本原则"></a>SQL优化的基本原则</h3><ul>
<li><p>永远用小结果集驱动大结果集</p>
<p> <code>From子句中sql解析顺序为从右向左，执行时会以最左边的表为基础表循环与右边表数据做笛卡尔积，所以以小结果集驱动能减少循环次数，从而减少对被驱动结果集的访问，从而减少被驱动表的锁定。</code>    </p>
</li>
<li><p>尽可能在索引中完成排序</p>
<p> <code>排序算法有两种：a.查出排序字段和行指针，排序，再通过行指针获得行数据所需列，返回结果集；b.取出所有排序列数据，在排序缓冲区中排完序直接返回结果集。索引排序是利用索引的有序性对数据排序的。</code></p>
</li>
<li><p>只取出子集需要的colums</p>
</li>
<li><p>仅仅使用最有效的过滤条件</p>
</li>
<li><p>尽可能避免复杂的Join和子查询</p>
</li>
</ul>
<h3 id="索引相关的总结"><a href="#索引相关的总结" class="headerlink" title="索引相关的总结"></a>索引相关的总结</h3><blockquote>
<p>什么是索引，可以把索引想象成数据库的目录，查找某一样东西之前，先在目录中确定好位置，直奔位置而去，这就是提高查询效率的原因。</p>
</blockquote>
<ul>
<li><p>索引的好处</p>
<pre><code> 提高数据检索效率，降低数据库的IO成本
 降低数据排序成本：要求排序字段和索引键字段一致
 降低数据分组成本：因为分组之前会先排序，同意如果分组字段与索引字段一致，会降低分组消耗的成本。
</code></pre>
</li>
<li><p>索引的弊端</p>
<pre><code> 索引是独立于基础数据的数据库对象，因此它会占用存储空间
 数据新增、更新会导致索引的同步更新，所以会增加数据新增、更新所消耗的成本
</code></pre>
</li>
<li><p>否需要创建索引</p>
<pre><code> 较为频繁的作为查询条件的字段需要创建索引
 唯一性太差的字段不适合单独创建索引，即使频繁作为查询条件
 更新非常频繁的字段不适合创建索引
 不会出现在where子句中的字段不要创建索引
</code></pre>
</li>
<li><p>索引语法</p>
<ul>
<li><p>唯一索引</p>
<pre><code>  ALTER TABLE tableName ADD UNIQUE indexName (column);
  CREATE UNIQUE INDEX indexName ON tableName (column);
</code></pre>
</li>
<li><p>普通索引</p>
<pre><code>  ALTER TABLE tableName ADD INDEX indexName(column);
  CREATE INDEX indexName ON tableName(column);
</code></pre>
</li>
<li><p>主键索引</p>
<pre><code>  ALTER TABLE tableName ADD PRIMARY KEY (column);
</code></pre>
</li>
<li><p>全文索引</p>
<pre><code>  ALTER TABLE tableName ADD FULLTEXT (column);
</code></pre>
</li>
<li><p>组合索引</p>
<pre><code>  ALTER TABLE tableName ADD INDEX indexName(col1,col2,...);
</code></pre>
</li>
</ul>
</li>
</ul>

    </div>
    <!--文末结束语-->
    
        <div style="text-align:center;color: #ccc;font-size:24px;"> --- 本文结束 <i class="fas fa-heart"></i> The End --- </div>
    
    <!--页脚广告-->
    
    <v-divider></v-divider>
    
    <div class="post-nav">             
        
            <div class="post-nav-button float-left">
                <v-icon>chevron_left</v-icon>
                <a class="font-weight-bold text-left" href="/content/2016/09/23/2016-09-23-mysql-explain/">
                    mysql中使用explain来分析Sql语句的性能
                </a>
            </div>
              
          
            <div class="post-nav-button float-right">
                <a class="font-weight-bold text-right" href="/content/2016/09/21/2016-09-21-mysql/">      
                    mysql 基础知识
                </a>
                <v-icon>chevron_right</v-icon>
            </div>
        
    </div>
</v-card>



        
                            <div id="mobile-footer" class="d-block d-md-none">
                                <v-divider></v-divider>
                                <div id="mobile-footer-content">
                                    <span>Theme: <a target="_blank" rel="noopener" href="https://github.com/kb1000fx/hexo-theme-insulin">Insulin</a> &nbsp; Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span><br>
                                    <span> &copy; 2015 - 2021 fuliln</span>
                                </div>
                            </div>                   
                        </v-col>                                            
                    </v-row>
                </v-container>
            </v-content>
        </v-app>
    </div>
    
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.2.30"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-base64@3.5.2/base64.min.js"></script>

<script src="/content/js/main.js"></script>




    <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://cdn.jsdelivr.net/npm/mermaid@8.4.8/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({
        startOnLoad: true,
        theme: "default"
    });</script>





</body>
</html>